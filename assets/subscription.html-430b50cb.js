import{_ as s,X as n,Y as a,a3 as e}from"./framework-1e2d737a.js";const t={},o=e(`<p>这一章主要介绍数据订阅功能。数据订阅意味着向一个openGemini集群发送的写入请求可以被转发到其它订阅结点。接下来的内容将介绍如何使用订阅功能。</p><h2 id="配置项" tabindex="-1"><a class="header-anchor" href="#配置项" aria-hidden="true">#</a> 配置项</h2><p>配置项包括：</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">subscriber</span><span class="token punctuation">]</span>
  <span class="token key property">enabled</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
  <span class="token key property">http-timeout</span> <span class="token punctuation">=</span> <span class="token string">&quot;30s&quot;</span>
  <span class="token key property">insecure-skip-verify</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
  <span class="token key property">https-certificate</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">write-buffer-size</span> <span class="token punctuation">=</span> <span class="token number">100</span>
  <span class="token key property">write-concurrency</span> <span class="token punctuation">=</span> <span class="token number">15</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>enabled</code>: 只有当 <code>enabled</code> 为true时，这个功能才会运行</li><li><code>http-timeout</code>: http客户端转发请求的超时时间</li><li><code>insecure-skip-verify</code>: 是否与订阅结点建立不安全的https连接</li><li><code>https-certificat</code>: CA证书存放路径，如果这一项是空字符串，将会使用系统默认的证书</li><li><code>write-buffer-size</code>: 写入通道中暂存的未来得及转发的写入请求数量</li><li><code>write-concurrency</code>: 消费同一个通道的协程数量。默认值是cpu数*2</li></ul><h2 id="创建订阅" tabindex="-1"><a class="header-anchor" href="#创建订阅" aria-hidden="true">#</a> 创建订阅</h2><p>可以在ts-cli中使用下列命令创建订阅：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- Pattern:</span>
<span class="token keyword">CREATE</span> SUBSCRIPTION <span class="token string">&quot;&lt;subscription_name&gt;&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;&lt;db_name&gt;&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;&lt;retention_policy&gt;&quot;</span> DESTINATIONS <span class="token operator">&lt;</span><span class="token keyword">ALL</span><span class="token operator">|</span><span class="token keyword">ANY</span><span class="token operator">&gt;</span> <span class="token string">&quot;&lt;subscription_endpoint_host&gt;&quot;</span>
<span class="token comment">-- 使用默认的retention policy</span>
<span class="token keyword">CREATE</span> SUBSCRIPTION <span class="token string">&quot;&lt;subscription_name&gt;&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;&lt;db_name&gt;&quot;</span> DESTINATIONS <span class="token operator">&lt;</span><span class="token keyword">ALL</span><span class="token operator">|</span><span class="token keyword">ANY</span><span class="token operator">&gt;</span> <span class="token string">&quot;&lt;subscription_endpoint_host&gt;&quot;</span>

<span class="token comment">-- Examples:</span>
<span class="token comment">-- Create a SUBSCRIPTION on database &#39;mydb&#39; and retention policy &#39;autogen&#39; that sends data to &#39;example.com:9090&#39; via HTTP.</span>
<span class="token keyword">CREATE</span> SUBSCRIPTION <span class="token string">&quot;sub0&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;mydb&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;autogen&quot;</span> DESTINATIONS <span class="token keyword">ALL</span> <span class="token string">&#39;http://example.com:9090&#39;</span>

<span class="token comment">-- Create a SUBSCRIPTION on database &#39;mydb&#39; and default retention policy that round-robins the data to &#39;h1.example.com:9090&#39; and &#39;h2.example.com:9090&#39; via https.</span>
<span class="token keyword">CREATE</span> SUBSCRIPTION <span class="token string">&quot;sub0&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;mydb&quot;</span> DESTINATIONS <span class="token keyword">ANY</span> <span class="token string">&#39;https://h1.example.com:9090&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://h2.example.com:9090&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果订阅节点开启了鉴权，可以通过修改url来设置认证：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> SUBSCRIPTION <span class="token string">&quot;sub0&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;mydb&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;autogen&quot;</span> DESTINATIONS <span class="token keyword">ALL</span> <span class="token string">&#39;http://username:password@example.com:9090&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="显示订阅" tabindex="-1"><a class="header-anchor" href="#显示订阅" aria-hidden="true">#</a> 显示订阅</h2><p>显示订阅是非常简单的，只有一种SQL语句写法：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> subscriptions
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="删除订阅" tabindex="-1"><a class="header-anchor" href="#删除订阅" aria-hidden="true">#</a> 删除订阅</h2><p>可以在ts-cli中使用如下命令删除订阅：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">--Pattern:</span>
<span class="token comment">--在指定的db_name和retention_policy上删除订阅</span>
<span class="token keyword">DROP</span> SUBSCRIPTION <span class="token string">&quot;&lt;subscription_name&gt;&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;&lt;db_name&gt;&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;&lt;retention_policy&gt;&quot;</span>
<span class="token comment">--Example:</span>
<span class="token keyword">DROP</span> SUBSCRIPTION <span class="token string">&quot;sub0&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;db0&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;autogen&quot;</span>

<span class="token comment">--Pattern:</span>
<span class="token comment">--在db_name上找到指定的订阅，并删除</span>
<span class="token keyword">DROP</span> SUBSCRIPTION <span class="token string">&quot;&lt;subscription_name&gt;&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;&lt;db_name&gt;&quot;</span>
<span class="token comment">--Example:</span>
<span class="token keyword">DROP</span> SUBSCRIPTION <span class="token string">&quot;sub0&quot;</span> <span class="token keyword">ON</span> <span class="token string">&quot;db0&quot;</span>

<span class="token comment">--Pattern:</span>
<span class="token comment">--在指定的db上删除所有订阅</span>
<span class="token keyword">DROP</span> <span class="token keyword">ALL</span> SUBSCRIPTIONS <span class="token keyword">ON</span> <span class="token string">&quot;&lt;db_name&gt;&quot;</span>
<span class="token comment">--Example:</span>
<span class="token keyword">DROP</span> <span class="token keyword">ALL</span> SUBSCRIPTIONS <span class="token keyword">ON</span> <span class="token string">&quot;db0&quot;</span>

<span class="token comment">--Pattern:</span>
<span class="token comment">--删除所有订阅</span>
<span class="token keyword">DROP</span> <span class="token keyword">ALL</span> SUBSCRIPTIONS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16),p=[o];function l(i,c){return n(),a("div",null,p)}const d=s(t,[["render",l],["__file","subscription.html.vue"]]);export{d as default};
