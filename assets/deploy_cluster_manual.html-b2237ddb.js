import{_ as e,X as o,Y as p,$ as s,a1 as n,Z as i,a3 as a,C as l}from"./framework-1e2d737a.js";const c={},u=a(`<div class="hint-container info"><p class="hint-container-title">Info</p><p>This document explores which components need to be deployed for manual deployment and helps familiarize yourself with how the open gemini cluster works. You are advised to <a href="./production_deployment_using_gemix">deploy with gemix</a> a production cluster.</p></div><p>Cluster deployment can deploy all three components of openGemini on one node, or distribute components to multiple nodes.</p><h2 id="deploy-a-pseudo-cluster" tabindex="-1"><a class="header-anchor" href="#deploy-a-pseudo-cluster" aria-hidden="true">#</a> Deploy a pseudo-cluster</h2><p>Deploy a pseudo-cluster means all components of the openGemini are deployed on the same node. Currently, the community provides the deployment script install_cluster.sh.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sh</span> scripts/install_cluster.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Run the command to start an openGemini cluster on the local host without modifying the configuration file.<br> The cluster includes one ts-sql, three ts-meta, and two ts-store. However, it only listens and runs on the local loopback address 127.0. 0.1. It can be used for local function testing and learning, and cannot provide external access services.<br> If you want to use local IP address so that can access openGemini with other machines, you need to modify the configuration file. This method requires you to have a better understanding of the operating system and network.<br><strong>Although possible, it is not recommended.</strong><br> The following uses a cluster with one ts-sql, three ts-meta, and two ts-store as an example to show how to deploy a openGemini cluster.</p><ol><li><strong>Allocate ports</strong><br> All nodes listen to the local IP address, for example, 192.168.0.1. Therefore, all components must use different ports. The following allocations can be made (for reference):</li></ol><figure><img src="https://user-images.githubusercontent.com/49023462/200800373-65a3ac6c-f38d-46ed-86d6-8b8f21232d50.png" alt="4" tabindex="0" loading="lazy"><figcaption>4</figcaption></figure><ol start="2"><li><strong>Modify the configuration file</strong><br> The openGemini has only one cluster configuration file openGemini.conf. If only one ts-meta, one ts-sql, and one ts-store, or two or one of them are deployed on a node, The same component is not deployed on the same node. In this case, all components on the node share the same configuration file openGemini.conf. Obviously, the pseudo-cluster cannot share one, because there are three ts-metas and two ts-stores on the same node. Therefore, we recommend a configuration file for each component. The method is as follows:</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">cp</span> –rf openGemini.conf sql.conf
<span class="token operator">&gt;</span> <span class="token function">cp</span> –rf openGemini.conf meta-1.conf
<span class="token operator">&gt;</span> <span class="token function">cp</span> –rf openGemini.conf meta-2.conf
<span class="token operator">&gt;</span> <span class="token function">cp</span> –rf openGemini.conf meta-3.conf
<span class="token operator">&gt;</span> <span class="token function">cp</span> –rf openGemini.conf store-1.conf
<span class="token operator">&gt;</span> <span class="token function">cp</span> –rf openGemini.conf store-2.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Modify the following information in the sql.conf file</strong><br> use 192.168.0.1 as an example.</li></ul><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8094&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8096&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">http</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8086&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># recommend change the directory.</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Modify the meta-1.conf file</strong></li></ul><p>Only the following information needs to be modified.</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8094&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8096&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">meta</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8088&quot;</span>
<span class="token key property">http-bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8091&quot;</span>
<span class="token key property">rpc-bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8092&quot;</span>
<span class="token comment"># recommend replace /tmp with other director</span>
<span class="token key property">dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/meta/1&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># replace /path</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1&quot;</span>
<span class="token key property">meta-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8010</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8012&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8013&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Modify the meta-2.conf file</strong><br> Only the following information needs to be modified:</li></ul><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8094&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8096&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">meta</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8089&quot;</span>
<span class="token key property">http-bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8093&quot;</span>
<span class="token key property">rpc-bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8094&quot;</span>
<span class="token comment"># recommend replace /tmp with other director</span>
<span class="token key property">dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/meta/2&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># replace /path</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1&quot;</span>
<span class="token key property">meta-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8012</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8012&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8013&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Modify the meta-3.conf file</strong><br> Only the following information needs to be modified:</li></ul><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8094&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8096&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">meta</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8090&quot;</span>
<span class="token key property">http-bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8095&quot;</span>
<span class="token key property">rpc-bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8096&quot;</span>
<span class="token comment"># recommend replace /tmp with other director</span>
<span class="token key property">dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/meta/3&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># replace /path</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1&quot;</span>
<span class="token key property">meta-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8013</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8012&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8013&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Modify the store-1.conf file</strong></li></ul><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8094&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8096&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">data</span><span class="token punctuation">]</span>
<span class="token key property">store-ingest-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8400&quot;</span>
<span class="token key property">store-select-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8401&quot;</span>
<span class="token key property">store-data-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/1&quot;</span>
<span class="token key property">store-wal-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/1&quot;</span>
<span class="token key property">store-meta-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/meta/1&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># replace /path</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1&quot;</span>
<span class="token key property">store-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8011</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8012&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8013&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Modify the store-2.conf file</strong></li></ul><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8094&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8096&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">data</span><span class="token punctuation">]</span>
<span class="token key property">store-ingest-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8402&quot;</span>
<span class="token key property">store-select-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8403&quot;</span>
<span class="token key property">store-data-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/2&quot;</span>
<span class="token key property">store-wal-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/2&quot;</span>
<span class="token key property">store-meta-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/meta/2&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># replace /path</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1&quot;</span>
<span class="token key property">store-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8014</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8012&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.1:8013&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>If you need to add a ts-store, change the port and run the ts-store again</strong></li></ul><ol start="3"><li>Start the cluster<br> Editing a Script</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt; cp –rf scripts/install_cluster.sh scripts/cluster.sh
&gt; vim scripts/cluster.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,26),r={href:"http://cluster.sh",target:"_blank",rel:"noopener noreferrer"},d=a(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># generate config</span>
<span class="token keyword">for</span><span class="token variable"><span class="token punctuation">((</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span>
<span class="token keyword">do</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> config/openGemini-<span class="token variable">$i</span>.conf
<span class="token function">cp</span> config/openGemini.conf config/openGemini-<span class="token variable">$i</span>.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/{{meta_addr_1}}/<span class="token variable">\${nodes<span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>/g&quot;</span> config/openGemini-<span class="token variable">$i</span>.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/{{meta_addr_2}}/<span class="token variable">\${nodes<span class="token punctuation">[</span>2<span class="token punctuation">]</span>}</span>/g&quot;</span> config/openGemini-<span class="token variable">$i</span>.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/{{meta_addr_3}}/<span class="token variable">\${nodes<span class="token punctuation">[</span>3<span class="token punctuation">]</span>}</span>/g&quot;</span> config/openGemini-<span class="token variable">$i</span>.conf
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/{{addr}}/<span class="token variable">\${nodes<span class="token punctuation">[</span>$i<span class="token punctuation">]</span>}</span>/g&quot;</span> config/openGemini-<span class="token variable">$i</span>.conf

<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/{{id}}/<span class="token variable">$i</span>/g&quot;</span> config/openGemini-<span class="token variable">$i</span>.conf
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Modify the configuration file and related log directories in the startup command.</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>~$ nohup build/ts-meta -config config/openGemini -1.conf -pidfile /tmp/openGemini/pid/meta1.pid &gt; /tmp/openGemini/logs/1/meta_extra1.log 2&gt;&amp;1 &amp;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Change to</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>~$ nohup build/ts-meta -config config/meta-1.conf -pidfile /path/openGemini/pid/meta1.pid &gt; /path/openGemini/logs/1/meta_extra1.log 2&gt;&amp;1 &amp;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>And so on. After the modification is complete, run the following command to start the pseudo-cluster:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt; sh scripts/cluster.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="deploy-a-standard-cluster" tabindex="-1"><a class="header-anchor" href="#deploy-a-standard-cluster" aria-hidden="true">#</a> Deploy a standard cluster</h2><p>Currently, there is no automatic script for cluster deployment. You can only manually deploy the script. welcome to contribute if you have had one.</p><p>The following figure shows the OpenGemini cluster deployment. The cluster has ts-meta(3x), ts-sql(2x), ts-store(2x).</p><figure><img src="https://user-images.githubusercontent.com/49023462/200800488-5683ecc2-e06b-4b65-a8ca-33b3bceaf6e4.jpg" alt="5" tabindex="0" loading="lazy"><figcaption>5</figcaption></figure><p>In this deployment mode, two components of the same type are not deployed on the same node, and no port contention occurs. In this case, all components on the same node share the same configuration file. For example, if Node1 is 192.168. 0.1, modify the openGemini.conf file as follows:</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.2:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.3:8092&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">meta</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8088&quot;</span>
<span class="token key property">http-bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8091&quot;</span>
<span class="token key property">rpc-bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8092&quot;</span>
<span class="token comment"># It is recommended that you change the directory.</span>
<span class="token key property">dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/data/meta/1&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">http</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8086&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">data</span><span class="token punctuation">]</span>
<span class="token key property">store-ingest-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8400&quot;</span>
<span class="token key property">store-select-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1:8401&quot;</span>
<span class="token comment"># It is recommended that you change the directory.</span>
<span class="token key property">store-data-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/data/1&quot;</span>
<span class="token key property">store-wal-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/data/1&quot;</span>
<span class="token key property">store-meta-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/data/meta/1&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># It is recommended that you change the directory.</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.1&quot;</span>
<span class="token key property">store-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8011</span>
<span class="token key property">meta-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8010</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.2:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.3:8010&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The configuration files of Node2 and Node3 remain unchanged.</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.2:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.3:8092&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">store-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8011</span>
<span class="token key property">meta-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8010</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.2:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.3:8010&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Replace the IP addresses of other nodes with the IP address 192.168.0.2 of Node2 and 192.168.0.3 of Node3 respectively. You do not need to change the port number.</p><p>**Note that the OpenGemini cluster has requirements on the component startup sequence. Start the ts-meta component on all three nodes first. (Example command): * *</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt; nohup ts-meta --config openGemini.conf -pidfile meta.pid &gt; meta_extra.log 2&gt;&amp;1 &amp;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Run the following command to start the ts-store component:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt; nohup ts-store --config openGemini.conf -pidfile store.pid &gt; store_extra.log 2&gt;&amp;1 &amp;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Run the following command to start the ts-sql component:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt; nohup ts-sql --config openGemini.conf -pidfile sql.pid &gt; sql_extra.log 2&gt;&amp;1 &amp;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="cluster-capacity-expansion" tabindex="-1"><a class="header-anchor" href="#cluster-capacity-expansion" aria-hidden="true">#</a> Cluster capacity expansion</h2><p>The following uses the expansion of the ts-store component as an example. The deployment modes are as follows:</p><ol><li>The new component ts-store is deployed on an existing node that already has the ts-store component. In this case, ports of the ts-store component need to be re-allocated. The following figure shows the deployment mode. <img src="https://user-images.githubusercontent.com/49023462/200800553-73d0bb25-de2c-4cf2-b401-8d8ddb00ded2.png" alt="6" loading="lazy"></li></ol><p>Prepare a configuration file for the new node. The configuration is as follows:</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token comment"># stay the same</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>meta-join <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.2:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.3:8092&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token table class-name">data</span><span class="token punctuation">]</span>
<span class="token key property">store-ingest-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.3:8402&quot;</span>
<span class="token key property">store-select-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.3:8403&quot;</span>
<span class="token key property">store-data-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/2&quot;</span>
<span class="token key property">store-wal-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/2&quot;</span>
<span class="token key property">store-meta-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/meta/2&quot;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># It is recommended that you change the directory.</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.3&quot;</span>
<span class="token key property">store-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8012</span>
<span class="token comment"># stay the same</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.2:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.3:8010&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>The new ts-store component is deployed on an existing node that does not have the ts-store component. In this case, you do not need to re-allocate ports unless the ports are occupied by other applications. The following figure shows the deployment mode. <img src="https://user-images.githubusercontent.com/49023462/200800580-2d1b0f70-fb89-42bd-864f-29da12cd3336.png" alt="7" loading="lazy"></li></ol><p>Other components on the node can share the same configuration file. You only need to modify the configuration items (IP address and directory) corresponding to the ts-store.</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">data</span><span class="token punctuation">]</span>
<span class="token key property">store-ingest-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.2:8400&quot;</span>
<span class="token key property">store-select-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.2:8401&quot;</span>
<span class="token key property">store-data-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/1&quot;</span>
<span class="token key property">store-wal-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/1&quot;</span>
<span class="token key property">store-meta-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/meta/1&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># It is recommended that you change the directory.</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.2&quot;</span>
<span class="token key property">store-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8011</span>
<span class="token comment"># stay the same</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.2:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.3:8010&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>The new component ts-store is deployed on the new node. The node does not have the ts-store component. In this case, you do not need to re-allocate ports unless the ports are occupied by other applications. The following figure shows the deployment mode.</li></ol><figure><img src="https://user-images.githubusercontent.com/49023462/200800601-896711db-17ee-45c5-8cee-1b9f4d342e63.png" alt="8" tabindex="0" loading="lazy"><figcaption>8</figcaption></figure><p>The configuration of the configuration file is the same as that of the second case.</p><div class="language-toml line-numbers-mode" data-ext="toml"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">common</span><span class="token punctuation">]</span>
<span class="token comment"># stay the same</span>
<span class="token key property">meta-join</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>meta-join <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.2:8092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.3:8092&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token table class-name">data</span><span class="token punctuation">]</span>
<span class="token key property">store-ingest-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.4:8400&quot;</span>
<span class="token key property">store-select-addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.4:8401&quot;</span>
<span class="token key property">store-data-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/1&quot;</span>
<span class="token key property">store-wal-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/1&quot;</span>
<span class="token key property">store-meta-dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/to/openGemini/data/meta/1&quot;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token table class-name">logging</span><span class="token punctuation">]</span>
<span class="token comment"># It is recommended that you change the directory.</span>
<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/path/openGemini/logs&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">gossip</span><span class="token punctuation">]</span>
<span class="token key property">bind-address</span> <span class="token punctuation">=</span> <span class="token string">&quot;192.168.0.4&quot;</span>
<span class="token key property">store-bind-port</span> <span class="token punctuation">=</span> <span class="token number">8011</span>
<span class="token comment"># stay the same</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.0.1:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.2:8010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.0.3:8010&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,34);function k(m,v){const t=l("ExternalLinkIcon");return o(),p("div",null,[u,s("p",null,[n("Delete or comment out lines 27 to 38 in the "),s("a",r,[n("cluster.sh"),i(t)]),n(" script.")]),d])}const b=e(c,[["render",k],["__file","deploy_cluster_manual.html.vue"]]);export{b as default};
